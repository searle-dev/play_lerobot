# 🔌 串口自动检测使用指南

## 📋 使用步骤

### 方法 1: 自动检测（推荐）

1. **点击"自动检测"按钮**
   - 系统会记录当前所有 USB 串口

2. **拔出 USB 线缆**
   - 拔出要检测的 USB 设备
   - 只拔出一个设备

3. **点击"完成检测"按钮**
   - ✅ 系统自动识别并填充端口
   - ✅ 可以看到端口已自动选中

4. **重新插入 USB（可选）**
   - 如需立即使用，重新插入 USB
   - 或稍后连接前再插入

5. **点击"刷新列表"（如需要）**
   - 重新插入 USB 后
   - 点击右上角"🔄 刷新列表"更新端口列表

### 方法 2: 手动选择

1. **查看可用端口**
   - 确保 USB 设备已连接
   - 查看下拉菜单中的端口列表

2. **从下拉菜单选择**
   - 串口 1: 选择 SO101 + 头部相机的端口
   - 串口 2: 选择与 Lekiwi 相同配置的端口

3. **点击"刷新列表"**
   - 如果看不到端口，点击刷新

## 🔍 工作原理

### 自动检测流程

```
┌─────────────────────────────────────────────┐
│ 1. 点击"自动检测"                           │
│    → 记录当前端口列表                       │
│    → 例如: [port1, port2]                   │
└─────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────┐
│ 2. 拔出 USB                                 │
│    → 用户物理拔出 USB 设备                  │
└─────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────┐
│ 3. 点击"完成检测"                           │
│    → 再次扫描端口                           │
│    → 例如: [port1]                          │
│    → 对比差异: port2 消失了                 │
│    → 识别出: port2 就是被拔出的设备         │
└─────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────┐
│ 4. 自动填充                                 │
│    → 将 port2 填充到选择框                  │
│    → 添加到端口列表（如果不存在）           │
│    → 显示在下拉菜单中                       │
└─────────────────────────────────────────────┘
```

### macOS 特殊处理

在 macOS 上，每个 USB 串口设备会创建两个设备文件：
- `/dev/tty.usbmodem*` - TTY 设备（推荐）
- `/dev/cu.usbmodem*` - Callout 设备

**自动识别**：系统会检测这两个成对的设备，只返回 tty 版本。

**示例**：
```
拔出 USB 时消失的设备:
- /dev/tty.usbmodem5AB01574971
- /dev/cu.usbmodem5AB01574971

系统识别: 这是同一个物理设备
返回结果: /dev/tty.usbmodem5AB01574971
```

## 💡 使用技巧

### 技巧 1: 先检测再插回
```
1. 检测串口 1 → 拔出 → 完成检测 ✅
2. 重新插入串口 1 的 USB
3. 检测串口 2 → 拔出 → 完成检测 ✅
4. 重新插入串口 2 的 USB
5. 点击"刷新列表"确认所有端口
```

### 技巧 2: 检测后稍后连接
```
1. 检测串口 1 → 拔出 → 完成检测 ✅
2. 检测串口 2 → 拔出 → 完成检测 ✅
3. 两个端口已记录，先不插回
4. 配置其他步骤（相机等）
5. 在连接机器人前插回所有 USB
```

### 技巧 3: 使用刷新按钮
```
如果：
- 重新插入 USB 后看不到端口
- 端口列表不完整
- 需要更新设备列表

操作：
→ 点击右上角"🔄 刷新列表"按钮
```

## ⚠️ 常见问题

### Q1: 提示"检测到多个端口变化"

**原因**：拔出了多个 USB 设备

**解决**：
1. 点击"取消"
2. 重新开始
3. 这次只拔出一个 USB 设备

### Q2: 提示"未检测到端口变化"

**原因**：没有拔出 USB，或系统未及时更新

**解决**：
1. 确认已物理拔出 USB
2. 等待 1-2 秒
3. 再次点击"完成检测"
4. 或取消后重新开始

### Q3: 检测成功但选择框为空

**原因**：这是正常的！USB 还没插回

**解决**：
1. 端口已记录（检查是否有值）
2. 重新插入 USB
3. 点击"🔄 刷新列表"
4. 应该能看到端口在列表中

### Q4: 不确定选哪个端口

**方法 1 - 使用自动检测**：
```
让系统帮你识别，最简单！
```

**方法 2 - 查看端口名称**：
```
macOS:
- /dev/tty.usbmodem5AB01574971 (第一个)
- /dev/tty.usbmodem5A7C1163141 (第二个)

Linux:
- /dev/ttyUSB0 (第一个)
- /dev/ttyUSB1 (第二个)
```

**方法 3 - 标记 USB 线**：
```
用不同颜色的标签或胶带标记
两根 USB 线，便于识别
```

## 🎯 最佳实践

### 推荐流程

```
┌────────────────────────────────────┐
│ 1. 确保两个 USB 都已连接           │
└────────────────────────────────────┘
            ↓
┌────────────────────────────────────┐
│ 2. 使用自动检测识别串口 1          │
│    → 点击自动检测                  │
│    → 拔出 USB                      │
│    → 完成检测                      │
│    → 插回 USB                      │
└────────────────────────────────────┘
            ↓
┌────────────────────────────────────┐
│ 3. 使用自动检测识别串口 2          │
│    → 点击自动检测                  │
│    → 拔出另一个 USB                │
│    → 完成检测                      │
│    → 插回 USB                      │
└────────────────────────────────────┘
            ↓
┌────────────────────────────────────┐
│ 4. 点击"刷新列表"确认              │
│    → 看到 2 个端口                 │
│    → 两个都已选中                  │
└────────────────────────────────────┘
            ↓
┌────────────────────────────────────┐
│ 5. 点击"连接机器人"                │
└────────────────────────────────────┘
```

## 🔧 调试信息

### 浏览器控制台

打开浏览器开发者工具（F12），在控制台查看：

```javascript
✅ 已加载 2 个串口
✅ 成功识别端口: /dev/tty.usbmodem5A7C1163141
```

### 后端日志

查看后端终端输出：

```
INFO:device_scanner:找到 2 个串口: [...]
INFO:device_scanner:断开前的端口: [...]
INFO:device_scanner:断开后的端口: [...]
INFO:device_scanner:检测到成对的 tty/cu 设备，使用: /dev/tty.xxx
INFO:device_scanner:成功识别端口: /dev/tty.xxx
```

## 📚 相关文档

- **macOS 串口特性**：查看 `backend/MACOS_PORTS.md`
- **完整项目文档**：查看 `README.md`
- **快速开始**：查看 `QUICKSTART.md`

---

**提示**：自动检测是最简单可靠的方式，推荐使用！如有问题，查看浏览器控制台和后端日志。

