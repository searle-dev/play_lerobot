<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SO101 机械臂网页控制</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- 顶部状态栏 -->
        <header class="header">
            <h1>🤖 SO101 机械臂控制台</h1>
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-label">连接状态:</span>
                    <span id="connection-status" class="status-value disconnected">未连接</span>
                </div>
                <div class="status-item">
                    <span class="status-label">端口:</span>
                    <span id="port-display" class="status-value">-</span>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 左侧：连接和控制 -->
            <section class="control-panel">
                <!-- 连接控制 -->
                <div class="card">
                    <h2>连接设置</h2>
                    <div class="form-group">
                        <label for="robot-port">机械臂端口:</label>
                        <input type="text" id="robot-port" value="/dev/tty.usbmodem5A7C1163141">
                        <button id="connect-btn" class="btn btn-primary">连接</button>
                        <button id="disconnect-btn" class="btn btn-danger" disabled>断开</button>
                    </div>
                </div>

                <!-- 键盘控制说明 -->
                <div class="card">
                    <h2>⌨️ 键盘控制</h2>
                    <div class="keyboard-guide">
                        <div class="key-group">
                            <h3>关节1 (底座旋转)</h3>
                            <div class="keys">
                                <kbd>Q</kbd> 逆时针 | <kbd>A</kbd> 顺时针
                            </div>
                        </div>
                        <div class="key-group">
                            <h3>关节2 (大臂上下)</h3>
                            <div class="keys">
                                <kbd>W</kbd> 下降 | <kbd>S</kbd> 上升
                            </div>
                        </div>
                        <div class="key-group">
                            <h3>关节3 (小臂弯曲)</h3>
                            <div class="keys">
                                <kbd>E</kbd> 弯曲 | <kbd>D</kbd> 伸直
                            </div>
                        </div>
                        <div class="key-group">
                            <h3>关节4 (腕部)</h3>
                            <div class="keys">
                                <kbd>R</kbd> 下 | <kbd>F</kbd> 上
                            </div>
                        </div>
                        <div class="key-group">
                            <h3>关节5 (腕部旋转)</h3>
                            <div class="keys">
                                <kbd>T</kbd> 逆时针 | <kbd>G</kbd> 顺时针
                            </div>
                        </div>
                        <div class="key-group">
                            <h3>夹爪</h3>
                            <div class="keys">
                                <kbd>Y</kbd> 打开 | <kbd>H</kbd> 关闭
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 虚拟按键 -->
                <div class="card">
                    <h2>🎮 虚拟按键</h2>
                    <div class="virtual-keyboard">
                        <div class="button-row">
                            <button class="control-btn" data-key="q">Q ←</button>
                            <button class="control-btn" data-key="a">A →</button>
                        </div>
                        <div class="button-row">
                            <button class="control-btn" data-key="w">W ↓</button>
                            <button class="control-btn" data-key="s">S ↑</button>
                        </div>
                        <div class="button-row">
                            <button class="control-btn" data-key="e">E 弯</button>
                            <button class="control-btn" data-key="d">D 直</button>
                        </div>
                        <div class="button-row">
                            <button class="control-btn" data-key="r">R ↓</button>
                            <button class="control-btn" data-key="f">F ↑</button>
                        </div>
                        <div class="button-row">
                            <button class="control-btn" data-key="t">T ↺</button>
                            <button class="control-btn" data-key="g">G ↻</button>
                        </div>
                        <div class="button-row">
                            <button class="control-btn gripper" data-key="y">Y 开</button>
                            <button class="control-btn gripper" data-key="h">H 关</button>
                        </div>
                    </div>
                    <div class="reset-controls">
                        <button id="reset-btn" class="btn btn-warning">重置到零位</button>
                    </div>
                </div>
            </section>

            <!-- 右侧：状态显示 -->
            <section class="status-panel">
                <!-- 关节位置显示 -->
                <div class="card">
                    <h2>📊 关节状态</h2>
                    <div class="joints-status" id="joints-status">
                        <!-- 动态生成 -->
                    </div>
                </div>

                <!-- 控制参数 -->
                <div class="card">
                    <h2>⚙️ 控制参数</h2>
                    <div class="params">
                        <div class="param-group">
                            <label>步进大小 (度):</label>
                            <input type="number" id="step-size" value="5" min="1" max="20" step="1">
                        </div>
                        <div class="param-group">
                            <label>夹爪步进:</label>
                            <input type="number" id="gripper-step" value="10" min="5" max="30" step="5">
                        </div>
                        <div class="param-group">
                            <label>比例增益 (Kp):</label>
                            <input type="number" id="kp" value="0.5" min="0.1" max="1.0" step="0.1">
                        </div>
                    </div>
                </div>

                <!-- 日志 -->
                <div class="card">
                    <h2>📝 操作日志</h2>
                    <div class="log-container" id="log-container">
                        <div class="log-item">等待连接...</div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 底部信息 -->
        <footer class="footer">
            <p>SO101 机械臂网页控制 | 按键盘对应按键或点击虚拟按键控制</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
